Описание работы биллинга
========================

Получение информации о тарифах
------------------------------

POST запрос

``/api/v1/billing/tariffs/``

Описание логики метода:

- возвращает (HTTP_200) и список в поле `tariffs`
содержащий для каждого тарифа поля `name`,  `code`, `price`, `parameter`

- либо возвращает ошибку (HTTP_200) и подробности в `detail` и `code`

Код тарифа (`code`) используется в других методах для оформления оплаты

Создание счёта для пользователя
-------------------------------

POST запрос

``/api/v1/billing/invoice/create``

Параметры:
`code` - код тарифа
`items` - через запятую список ИД подключенных альбомов

пример: {"code": "04012020_100", "items": ["225844689", "153340216"]}

Описание логики метода:

- возвращает (HTTP_200) и поля `label` - ИД инвойса и `receiver` номер кошелька для формы
- либо возвращает ошибку (HTTP_200) и подробности в `detail` и `code`

Документация формы
https://yandex.ru/dev/money/doc/payment-buttons/reference/forms-docpage/


Проверка оплаты счёта для пользователя
--------------------------------------

POST запрос

``/api/v1/billing/invoice/``

Параметры:
`label` - ИД инвойса (полученный ранее) da40ff95-a54e-4a29-b137-f3562de14eb5

Описание логики метода:

- либо возвращает ошибку (HTTP_200) и подробности в `detail` и `code`
- либо возвращает (HTTP_200) и поля `status` - текстовый статус и `code` коды статуса

    'N' - 'Выставлен'

    'U' - 'Отменен'

    'W' - 'Подтвержден' Ожидает зачисления, счет переполнен!

    'P' - 'Не принят (код протекции)'

    'E' - 'Не принят (не верная сумма)'

    'V' - 'Оплачен'


Получение активной подписки для пользователя
--------------------------------------------

данные отдаются в методе ``/api/v1/user/info/``

поля подписки
    `expires_date` - дата когда истекает подписка,
    `activate_date` дата активации
    `sys_code` код подписки
    `parameter` лимит фото для проверки

- либо возвращает ошибку (HTTP_200) и подробности в `detail` и `code`


Добавление Альбома в Подписку
-----------------------------

POST запрос

``billing/subscription/expand``

Параметры:
`items` - через запятую список ИД подключенных альбомов

пример: {"items": ["225844689", "153340216"]}

Описание логики метода:

- возвращает (HTTP_200) и {'detail': 'OK'} в случае успешного добавления
- возвращает (HTTP_200) и ошибку 1001, если передан пустой список `items`
- возвращает (HTTP_200) и ошибку 3001, если действующая подписка не найдена
- возвращает (HTTP_200) и ошибку 3004, если все переданные альбомы уже подключены в подписке
- возвращает (HTTP_200) и ошибку 3005, если обновленное число фото во всех альбомах превышает оплаченный лимит
